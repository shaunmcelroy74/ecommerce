<!-- app/views/carts/show.html.erb -->

<h1>Your Shopping Cart</h1>

<% if @cart.cart_items.any? %>
  <table class="w-full mb-6 border-collapse">
    <thead>
      <tr>
        <th>Product</th>
        <th>Qty</th>
        <th>Unit Price</th>
        <th>Total</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @cart.cart_items.each do |item| %>
        <% p = item.product %>
        <tr>
          <td><%= p.name %></td>
          <td>
            <%= form_with model: item,
                          url: cart_item_path(item),
                          method: :patch,
                          local: true do |f| %>
              <%= f.number_field :quantity,
                                 value: item.quantity,
                                 in: 1..99,
                                 class: "w-16 text-center" %>
              <%= f.submit "Update", class: "ml-2 px-2 py-1 bg-gray-200 rounded text-black" %>
            <% end %>
          </td>
          <td><%= number_to_currency(p.price / 100.0) %></td>
          <td><%= number_to_currency((p.price * item.quantity) / 100.0) %></td>
          <td>
            <%= button_to "🗑️",
                          cart_item_path(item),
                          method: :delete,
                          data: { confirm: "Remove this item?" },
                          class: "px-2 py-1 bg-red-200 rounded" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <%= link_to "Proceed to Checkout", new_checkout_path,
              class: "px-4 py-2 bg-gray-600 text-white rounded" %>
<% else %>
  <p>Your cart is empty</p>
<% end %>
